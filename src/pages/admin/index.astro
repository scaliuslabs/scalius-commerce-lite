---
// src/pages/admin/index.astro
import AdminLayout from "../../layouts/AdminLayout.astro";
import { DashboardStats } from "../../components/admin/DashboardStats";
import { RecentOrders } from "../../components/admin/RecentOrders";
import { QuickActions } from "../../components/admin/QuickActions";
import { WelcomeBanner } from "../../components/admin/WelcomeBanner";
import {
  getDashboardStats,
  getRecentOrders,
  getDailyActivityData,
} from "../../lib/admin";

// Parallel fetch for faster dashboard load (vs sequential)
const [stats, recentOrders, dailyActivityData] = await Promise.all([
  getDashboardStats(),
  getRecentOrders(11),
  getDailyActivityData(90),
]);

const pageTitle = "Admin Dashboard";
---

<AdminLayout title={pageTitle}>
  <div class="space-y-8">
    <WelcomeBanner client:idle />

    <div class="
      overflow-hidden rounded-2xl 
      border border-gray-100/80 dark:border-gray-800/60 
      bg-white dark:bg-gray-900/50 
      shadow-[0_1px_3px_0_rgb(0,0,0,0.08)] dark:shadow-none 
      transition-all duration-200 ease-out
    ">
      <div class="p-5 md:p-6"> 
        <DashboardStats
          client:idle
          totalProducts={stats.totalProducts}
          totalCustomers={stats.totalCustomers}
          currentMonth={stats.currentMonth}
          initialDailyData={dailyActivityData}
        />
      </div>
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
      <div class="lg:col-span-2">
        <RecentOrders client:visible orders={recentOrders} />
      </div>

      <div class="lg:col-span-1">
        <QuickActions client:visible /> 
      </div>
    </div>
  </div>
</AdminLayout>