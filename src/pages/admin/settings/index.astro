---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import GeneralSettingsPage from "../../../components/admin/settings/GeneralSettingsPage";
import { db } from "../../../db";
import { siteSettings } from "../../../db/schema";

const [settings] = await db.select().from(siteSettings).limit(1);

const safeParseJSON = (jsonString: string | null | undefined) => {
  if (!jsonString) return null;
  try {
    return JSON.parse(jsonString);
  } catch {
    return null;
  }
};

const headerConfig = safeParseJSON(settings?.headerConfig) || {};
const footerConfig = safeParseJSON(settings?.footerConfig) || {};
---

<AdminLayout title="General Settings">
  <GeneralSettingsPage
    client:idle
    headerConfig={headerConfig}
    footerConfig={footerConfig}
  />
</AdminLayout>
