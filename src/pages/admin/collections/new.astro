---
import AdminLayout from "@/layouts/AdminLayout.astro";
import { CollectionForm } from "@/components/admin/CollectionForm";
import { db } from "@/db";
import { categories, products } from "@/db/schema";
import { isNull } from "drizzle-orm";

const allCategories = await db
  .select({
    id: categories.id,
    name: categories.name,
  })
  .from(categories)
  .where(isNull(categories.deletedAt));

const allProducts = await db
  .select({
    id: products.id,
    name: products.name,
    categoryId: products.categoryId,
  })
  .from(products)
  .where(isNull(products.deletedAt));
---

<AdminLayout title="New Collection">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">New Collection</h1>
      <p class="text-muted-foreground">Create a new product collection</p>
    </div>
  </div>

  <div class="mt-8">
    <CollectionForm
      categories={allCategories}
      products={allProducts}
      client:load
    />
  </div>
</AdminLayout>
